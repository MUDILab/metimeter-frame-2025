<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Choose your field - Metimeter</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="icon" href="favicon.png" type="image/png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="js/tools-data.js" defer></script>
  <script>
    const fieldNames = {
    financial: "Financial",
    medical: "Medical",
    datascience: "Data Science",
    management: "Management",
    uxdesigner: "UX Designer"
  }
  </script>
</head>
<body class="bg-gray-100 min-h-screen px-6 flex items-center justify-center relative">
  <img src="src/bg_civetta.png" class="absolute inset-0 w-full h-full object-cover -z-10" alt="Background" />

  <div id="loaderframe" class="absolute inset-0 bg-gray-100 flex items-center justify-center opacity-100 transition-opacity duration-300 z-10">
    <div class="w-12 h-12 border-4 border-[#132436] border-t-transparent rounded-full animate-spin"></div>
  </div>

  <div class="text-center flex flex-col items-center">
    <h1 class="text-[#132436] text-4xl md:text-4xl font-extrabold mb-3 mt-8">
      Metimeter tools, right here for you.
    </h1>

   <p id="field-description" class="text-gray-600 text-base md:text-lg mb-6 max-w-xl">
    <!-- Will be injected by JS -->
    </p>




    <div id="tools-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-6 w-full max-w-5xl mx-auto">
      <!-- Tool cards injected by JS -->
    </div>
    <div class="mt-8"></div>
  </div>

  <script>
    let fieldReceived = false;

    function generateToolGrid(tools) {
      const grid = document.getElementById("tools-grid");
      grid.innerHTML = "";

      tools.forEach(tool => {
        const toolCard = document.createElement("div");
        toolCard.className = "tool-option bg-white rounded-xl shadow-md p-5 flex flex-col items-center text-center cursor-pointer transition-transform hover:scale-105";
        toolCard.dataset.url = tool.url;
        toolCard.dataset.color = tool.dotColor;

        toolCard.innerHTML = `
          <div class="w-14 h-14 rounded-full flex items-center justify-center mb-3 ${tool.dotColor}">
            ${tool.dotIcon}
          </div>
          <h3 class="text-lg font-bold text-[#132436] mb-1">${tool.title}</h3>
          <p class="text-sm text-gray-500">${tool.description}</p>
        `;

          toolCard.addEventListener("click", () => {
            window.parent.postMessage({
              type: "toolSelected",
              url: tool.url,
              title: tool.title
            }, "*");
          });

        grid.appendChild(toolCard);
      });
    }

    function loadTools(field) {
  const description = document.getElementById("field-description");

  if (typeof toolDataByField !== "undefined") {
    const tools = toolDataByField[field] || toolDataByField["generic"];
    generateToolGrid(tools)

    if (description) {
      if (field === "generic") {
        description.innerHTML = `
          Organized by field of interest (changeable from
          <span class="inline-flex items-center gap-1 whitespace-nowrap">
            <svg xmlns="http://www.w3.org/2000/svg" fill="#132436" viewBox="0 0 24 24" class="w-5 h-5 translate-y-[4px]">
              <path fill-rule="evenodd" d="M11.078 2.25c-.917 0-1.699.663-1.85 1.567L9.05 4.889c-.02.12-.115.26-.297.348a7.493 7.493 0 0 0-.986.57c-.166.115-.334.126-.45.083L6.3 5.508a1.875 1.875 0 0 0-2.282.819l-.922 1.597a1.875 1.875 0 0 0 .432 2.385l.84.692c.095.078.17.229.154.43a7.598 7.598 0 0 0 0 1.139c.015.2-.059.352-.153.43l-.841.692a1.875 1.875 0 0 0-.432 2.385l.922 1.597a1.875 1.875 0 0 0 2.282.818l1.019-.382c.115-.043.283-.031.45.082.312.214.641.405.985.57.182.088.277.228.297.35l.178 1.071c.151.904.933 1.567 1.85 1.567h1.844c.916 0 1.699-.663 1.85-1.567l.178-1.072c.02-.12.114-.26.297-.349.344-.165.673-.356.985-.57.167-.114.335-.125.45-.082l1.02.382a1.875 1.875 0 0 0 2.28-.819l.923-1.597a1.875 1.875 0 0 0-.432-2.385l-.84-.692c-.095-.078-.17-.229-.154-.43a7.614 7.614 0 0 0 0-1.139c-.016-.2.059-.352.153-.43l.84-.692c.708-.582.891-1.59.433-2.385l-.922-1.597a1.875 1.875 0 0 0-2.282-.818l-1.02.382c-.114.043-.282.031-.449-.083a7.49 7.49 0 0 0-.985-.57c-.183-.087-.277-.227-.297-.348l-.179-1.072a1.875 1.875 0 0 0-1.85-1.567h-1.843ZM12 15.75a3.75 3.75 0 1 0 0-7.5 3.75 3.75 0 0 0 0 7.5Z." clip-rule="evenodd"/>
            </svg>
            <span class="font-semibold translate-y-[3.5px]">settings</span>
          </span>) <br> to help you get started.
        `;
      } else {
        description.innerHTML = `
          Prioritized with descriptions by your selected field: <span class="font-semibold capitalize text-[#132436]">${fieldNames[field]}</span>. <br>
          You can change this from 
          <span class="inline-flex items-center gap-1 whitespace-nowrap">
            <svg xmlns="http://www.w3.org/2000/svg" fill="#132436" viewBox="0 0 24 24" class="w-5 h-5 translate-y-[4px]">
              <path fill-rule="evenodd" d="M11.078 2.25c-.917 0-1.699.663-1.85 1.567L9.05 4.889c-.02.12-.115.26-.297.348a7.493 7.493 0 0 0-.986.57c-.166.115-.334.126-.45.083L6.3 5.508a1.875 1.875 0 0 0-2.282.819l-.922 1.597a1.875 1.875 0 0 0 .432 2.385l.84.692c.095.078.17.229.154.43a7.598 7.598 0 0 0 0 1.139c.015.2-.059.352-.153.43l-.841.692a1.875 1.875 0 0 0-.432 2.385l.922 1.597a1.875 1.875 0 0 0 2.282.818l1.019-.382c.115-.043.283-.031.45.082.312.214.641.405.985.57.182.088.277.228.297.35l.178 1.071c.151.904.933 1.567 1.85 1.567h1.844c.916 0 1.699-.663 1.85-1.567l.178-1.072c.02-.12.114-.26.297-.349.344-.165.673-.356.985-.57.167-.114.335-.125.45-.082l1.02.382a1.875 1.875 0 0 0 2.28-.819l.923-1.597a1.875 1.875 0 0 0-.432-2.385l-.84-.692c-.095-.078-.17-.229-.154-.43a7.614 7.614 0 0 0 0-1.139c-.016-.2.059-.352.153-.43l.84-.692c.708-.582.891-1.59.433-2.385l-.922-1.597a1.875 1.875 0 0 0-2.282-.818l-1.02.382c-.114.043-.282.031-.449-.083a7.49 7.49 0 0 0-.985-.57c-.183-.087-.277-.227-.297-.348l-.179-1.072a1.875 1.875 0 0 0-1.85-1.567h-1.843ZM12 15.75a3.75 3.75 0 1 0 0-7.5 3.75 3.75 0 0 0 0 7.5Z" clip-rule="evenodd"/>
            </svg>
            <span class="font-semibold translate-y-[3.5px]">settings</span>
          </span> if needed.
        `;
      }
    }
  }
}


    window.addEventListener("message", (event) => {
      if (event.data?.type === "setField") {
        const field = event.data.field || "generic";
        fieldReceived = true;
        loadTools(field);

        const loader = document.getElementById("loaderframe");
        loader.classList.remove("opacity-100");
        loader.classList.add("opacity-0", "pointer-events-none");
      }
    });

 let retryCount = 0;
const maxRetries = 3;

function checkFieldReceived() {
  if (!fieldReceived) {
    retryCount++;
    window.parent.postMessage({ type: "readyForField" }, "*");

    if (retryCount < maxRetries) {
      setTimeout(checkFieldReceived, 500);
    } else {
      loadTools("generic");
      const loader = document.getElementById("loaderframe");
      loader.classList.remove("opacity-100");
      loader.classList.add("opacity-0", "pointer-events-none");
    }
  }
}

setTimeout(checkFieldReceived, 500);

  </script>
</body>
</html>
